-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.apartment_sections (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  guide_id uuid NOT NULL,
  tenant_id uuid NOT NULL,
  section_type character varying NOT NULL,
  title character varying NOT NULL,
  description text,
  details text,
  image_url text,
  icon character varying,
  order_index integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  amenities ARRAY DEFAULT '{}'::text[],
  CONSTRAINT apartment_sections_pkey PRIMARY KEY (id),
  CONSTRAINT apartment_sections_guide_id_fkey FOREIGN KEY (guide_id) REFERENCES public.property_guides(id),
  CONSTRAINT apartment_sections_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.bookings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  booking_code character varying NOT NULL,
  property_id uuid NOT NULL,
  person_id uuid,
  check_in_date date NOT NULL,
  check_out_date date NOT NULL,
  number_of_guests integer NOT NULL DEFAULT 1 CHECK (number_of_guests >= 0),
  total_amount numeric NOT NULL DEFAULT 0,
  booking_status_id uuid,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  channel_id uuid,
  sales_commission_amount numeric NOT NULL DEFAULT 0,
  collection_commission_amount numeric NOT NULL DEFAULT 0,
  tax_amount numeric NOT NULL DEFAULT 0,
  net_amount numeric NOT NULL DEFAULT 0,
  channel_booking_number character varying,
  booking_type_id uuid,
  CONSTRAINT bookings_pkey PRIMARY KEY (id),
  CONSTRAINT bookings_channel_id_fkey FOREIGN KEY (channel_id) REFERENCES public.sales_channels(id),
  CONSTRAINT bookings_booking_type_id_fkey FOREIGN KEY (booking_type_id) REFERENCES public.configuration_values(id),
  CONSTRAINT bookings_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT bookings_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id),
  CONSTRAINT bookings_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.persons(id),
  CONSTRAINT bookings_booking_status_id_fkey FOREIGN KEY (booking_status_id) REFERENCES public.configuration_values(id),
  CONSTRAINT bookings_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.configuration_types (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  name character varying NOT NULL,
  description text,
  is_active boolean DEFAULT true,
  sort_order integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT configuration_types_pkey PRIMARY KEY (id),
  CONSTRAINT configuration_types_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.configuration_values (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  configuration_type_id uuid NOT NULL,
  value character varying NOT NULL,
  label character varying NOT NULL,
  description text,
  sort_order integer DEFAULT 0,
  color character varying,
  icon character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  is_default boolean NOT NULL DEFAULT false,
  CONSTRAINT configuration_values_pkey PRIMARY KEY (id),
  CONSTRAINT configuration_values_configuration_type_id_fkey FOREIGN KEY (configuration_type_id) REFERENCES public.configuration_types(id)
);
CREATE TABLE public.guide_contact_info (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid,
  guide_id uuid,
  host_names character varying,
  phone character varying,
  email character varying,
  whatsapp character varying,
  emergency_numbers jsonb,
  service_issues ARRAY,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  support_person_name text,
  support_person_phone text,
  interest_phones jsonb DEFAULT '[]'::jsonb,
  host_message text,
  support_person_whatsapp text,
  CONSTRAINT guide_contact_info_pkey PRIMARY KEY (id),
  CONSTRAINT guide_contact_info_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT guide_contact_info_guide_id_fkey FOREIGN KEY (guide_id) REFERENCES public.property_guides(id)
);
CREATE TABLE public.guide_places (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid,
  guide_id uuid,
  name character varying NOT NULL,
  description text,
  distance character varying,
  rating numeric,
  badge character varying,
  image_url text,
  place_type character varying DEFAULT 'beach'::character varying,
  order_index integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  url text,
  price_range character varying,
  review_count integer,
  cuisine_type character varying,
  address text,
  activity_type character varying,
  duration character varying,
  price_info character varying,
  amenities ARRAY DEFAULT '{}'::text[],
  shopping_type character varying,
  walking_time integer,
  driving_time integer,
  CONSTRAINT guide_places_pkey PRIMARY KEY (id),
  CONSTRAINT guide_places_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT guide_places_guide_id_fkey FOREIGN KEY (guide_id) REFERENCES public.property_guides(id)
);
CREATE TABLE public.guide_sections (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid,
  guide_id uuid,
  section_type character varying NOT NULL,
  title character varying,
  content text,
  icon character varying,
  order_index integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT guide_sections_pkey PRIMARY KEY (id),
  CONSTRAINT guide_sections_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT guide_sections_guide_id_fkey FOREIGN KEY (guide_id) REFERENCES public.property_guides(id)
);
CREATE TABLE public.health_checks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  status character varying NOT NULL CHECK (status::text = ANY (ARRAY['success'::character varying, 'error'::character varying]::text[])),
  response_time_ms integer NOT NULL,
  error_message text,
  error_code character varying,
  query_executed text NOT NULL,
  database_connected boolean NOT NULL DEFAULT true,
  tenant_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT health_checks_pkey PRIMARY KEY (id),
  CONSTRAINT health_checks_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT health_checks_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.house_guide_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid,
  guide_id uuid,
  title character varying NOT NULL,
  description text,
  details text,
  icon character varying,
  order_index integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT house_guide_items_pkey PRIMARY KEY (id),
  CONSTRAINT house_guide_items_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT house_guide_items_guide_id_fkey FOREIGN KEY (guide_id) REFERENCES public.property_guides(id)
);
CREATE TABLE public.house_rules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid,
  guide_id uuid,
  title character varying NOT NULL,
  description text,
  icon character varying,
  order_index integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT house_rules_pkey PRIMARY KEY (id),
  CONSTRAINT house_rules_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT house_rules_guide_id_fkey FOREIGN KEY (guide_id) REFERENCES public.property_guides(id)
);
CREATE TABLE public.movement_expense_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  movement_id uuid NOT NULL,
  service_provider_service_id uuid,
  service_name character varying NOT NULL,
  amount numeric NOT NULL CHECK (amount >= 0::numeric),
  tax_type_id uuid,
  tax_amount numeric NOT NULL DEFAULT 0 CHECK (tax_amount >= 0::numeric),
  total_amount numeric NOT NULL CHECK (total_amount >= 0::numeric),
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT movement_expense_items_pkey PRIMARY KEY (id),
  CONSTRAINT movement_expense_items_movement_id_fkey FOREIGN KEY (movement_id) REFERENCES public.movements(id),
  CONSTRAINT movement_expense_items_service_provider_service_id_fkey FOREIGN KEY (service_provider_service_id) REFERENCES public.service_provider_services(id),
  CONSTRAINT movement_expense_items_tax_type_id_fkey FOREIGN KEY (tax_type_id) REFERENCES public.configuration_values(id)
);
CREATE TABLE public.movements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  movement_type_id uuid NOT NULL,
  booking_id uuid,
  service_provider_id uuid,
  service_provider_service_id uuid,
  treasury_account_id uuid NOT NULL,
  payment_method_id uuid NOT NULL,
  movement_status_id uuid NOT NULL,
  amount numeric NOT NULL CHECK (amount > 0::numeric),
  invoice_number character varying,
  reference text,
  movement_date date NOT NULL,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT movements_pkey PRIMARY KEY (id),
  CONSTRAINT movements_treasury_account_id_fkey FOREIGN KEY (treasury_account_id) REFERENCES public.treasury_accounts(id),
  CONSTRAINT movements_payment_method_id_fkey FOREIGN KEY (payment_method_id) REFERENCES public.configuration_values(id),
  CONSTRAINT movements_movement_status_id_fkey FOREIGN KEY (movement_status_id) REFERENCES public.configuration_values(id),
  CONSTRAINT movements_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id),
  CONSTRAINT movements_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT movements_movement_type_id_fkey FOREIGN KEY (movement_type_id) REFERENCES public.configuration_values(id),
  CONSTRAINT movements_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.bookings(id),
  CONSTRAINT movements_service_provider_id_fkey FOREIGN KEY (service_provider_id) REFERENCES public.service_providers(id),
  CONSTRAINT movements_service_provider_service_id_fkey FOREIGN KEY (service_provider_service_id) REFERENCES public.service_provider_services(id)
);
CREATE TABLE public.payments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  booking_id uuid,
  payment_code character varying NOT NULL,
  payment_date timestamp with time zone DEFAULT now(),
  amount numeric NOT NULL,
  payment_method_id uuid,
  payment_status_id uuid,
  transaction_reference character varying,
  notes text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT payments_pkey PRIMARY KEY (id),
  CONSTRAINT payments_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT payments_payment_method_id_fkey FOREIGN KEY (payment_method_id) REFERENCES public.configuration_values(id),
  CONSTRAINT payments_payment_status_id_fkey FOREIGN KEY (payment_status_id) REFERENCES public.configuration_values(id)
);
CREATE TABLE public.person_contact_infos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  person_id uuid NOT NULL,
  contact_type character varying NOT NULL,
  contact_value character varying NOT NULL,
  is_primary boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  contact_name character varying,
  CONSTRAINT person_contact_infos_pkey PRIMARY KEY (id),
  CONSTRAINT person_contact_infos_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT person_contact_infos_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.persons(id)
);
CREATE TABLE public.person_fiscal_addresses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  person_id uuid NOT NULL,
  street character varying,
  number character varying,
  floor character varying,
  door character varying,
  city character varying,
  province character varying,
  postal_code character varying,
  country character varying,
  is_primary boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT person_fiscal_addresses_pkey PRIMARY KEY (id),
  CONSTRAINT person_fiscal_addresses_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT person_fiscal_addresses_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.persons(id)
);
CREATE TABLE public.persons (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  person_type character varying NOT NULL,
  first_name character varying,
  last_name character varying,
  full_name character varying,
  document_type character varying,
  document_number character varying,
  birth_date date,
  nationality character varying,
  notes text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT persons_pkey PRIMARY KEY (id),
  CONSTRAINT persons_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.practical_info (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid,
  guide_id uuid,
  category character varying NOT NULL,
  title character varying NOT NULL,
  description text,
  details jsonb,
  icon character varying,
  order_index integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT practical_info_pkey PRIMARY KEY (id),
  CONSTRAINT practical_info_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT practical_info_guide_id_fkey FOREIGN KEY (guide_id) REFERENCES public.property_guides(id)
);
CREATE TABLE public.properties (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  property_code character varying NOT NULL,
  name character varying NOT NULL,
  description text,
  property_type_id uuid,
  street character varying,
  number character varying,
  floor character varying,
  door character varying,
  city character varying,
  province character varying,
  postal_code character varying,
  country character varying,
  bedrooms integer,
  bathrooms integer,
  max_guests integer,
  square_meters numeric,
  owner_person_id uuid,
  is_active boolean DEFAULT true,
  check_in_time time without time zone DEFAULT '15:00:00'::time without time zone,
  check_out_time time without time zone DEFAULT '11:00:00'::time without time zone,
  base_price_per_night numeric,
  cleaning_fee numeric,
  security_deposit numeric,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  min_nights integer DEFAULT 1 CHECK (min_nights >= 1),
  slug character varying NOT NULL,
  image_url text,
  CONSTRAINT properties_pkey PRIMARY KEY (id),
  CONSTRAINT properties_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT properties_property_type_id_fkey FOREIGN KEY (property_type_id) REFERENCES public.configuration_values(id),
  CONSTRAINT properties_owner_person_id_fkey FOREIGN KEY (owner_person_id) REFERENCES public.persons(id)
);
CREATE TABLE public.property_amenities (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  property_id uuid NOT NULL,
  amenity_type_id uuid,
  name character varying NOT NULL,
  description text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT property_amenities_pkey PRIMARY KEY (id),
  CONSTRAINT property_amenities_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT property_amenities_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id),
  CONSTRAINT property_amenities_amenity_type_id_fkey FOREIGN KEY (amenity_type_id) REFERENCES public.configuration_values(id)
);
CREATE TABLE public.property_guides (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid,
  property_id uuid,
  title character varying NOT NULL DEFAULT 'Guía del Huésped'::character varying,
  welcome_message text,
  host_names character varying,
  host_signature text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  latitude numeric CHECK (latitude IS NULL OR latitude >= '-90'::integer::numeric AND latitude <= 90::numeric),
  longitude numeric CHECK (longitude IS NULL OR longitude >= '-180'::integer::numeric AND longitude <= 180::numeric),
  locality character varying,
  CONSTRAINT property_guides_pkey PRIMARY KEY (id),
  CONSTRAINT property_guides_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT property_guides_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id)
);
CREATE TABLE public.property_highlights (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  property_id uuid NOT NULL,
  tenant_id uuid NOT NULL,
  title character varying NOT NULL,
  description text NOT NULL,
  icon character varying NOT NULL,
  sort_order integer NOT NULL DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT property_highlights_pkey PRIMARY KEY (id),
  CONSTRAINT property_highlights_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT property_highlights_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id)
);
CREATE TABLE public.property_images (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  property_id uuid NOT NULL,
  image_url text NOT NULL,
  title character varying,
  description text,
  sort_order integer DEFAULT 0,
  is_primary boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  is_cover boolean NOT NULL DEFAULT false,
  created_by uuid,
  CONSTRAINT property_images_pkey PRIMARY KEY (id),
  CONSTRAINT property_images_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id),
  CONSTRAINT property_images_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT property_images_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id)
);
CREATE TABLE public.property_pricing_plans (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  property_id uuid NOT NULL,
  tenant_id uuid NOT NULL,
  plan_type character varying NOT NULL CHECK (plan_type::text = ANY (ARRAY['night'::character varying, 'week'::character varying, 'fortnight'::character varying]::text[])),
  season character varying NOT NULL CHECK (season::text = ANY (ARRAY['high'::character varying, 'low'::character varying, 'all'::character varying]::text[])),
  base_price numeric NOT NULL CHECK (base_price >= 0::numeric),
  discount_percentage numeric NOT NULL DEFAULT 0 CHECK (discount_percentage >= 0::numeric AND discount_percentage <= 100::numeric),
  final_price numeric NOT NULL CHECK (final_price >= 0::numeric),
  description text,
  features ARRAY DEFAULT '{}'::text[],
  is_active boolean NOT NULL DEFAULT true,
  sort_order integer NOT NULL DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT property_pricing_plans_pkey PRIMARY KEY (id),
  CONSTRAINT property_pricing_plans_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id),
  CONSTRAINT property_pricing_plans_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.property_reviews (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  property_id uuid NOT NULL,
  tenant_id uuid NOT NULL,
  guest_name text NOT NULL,
  person_id uuid,
  booking_id uuid,
  rating integer NOT NULL CHECK (rating >= 1 AND rating <= 5),
  comment text NOT NULL,
  review_date date NOT NULL,
  is_approved boolean NOT NULL DEFAULT false,
  source character varying NOT NULL DEFAULT 'manual'::character varying CHECK (source::text = ANY (ARRAY['manual'::character varying, 'external'::character varying, 'booking'::character varying]::text[])),
  external_id text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT property_reviews_pkey PRIMARY KEY (id),
  CONSTRAINT property_reviews_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id),
  CONSTRAINT property_reviews_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT property_reviews_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.persons(id),
  CONSTRAINT property_reviews_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.bookings(id),
  CONSTRAINT property_reviews_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.property_sales_channels (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  property_id uuid NOT NULL,
  sales_channel_id uuid NOT NULL,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT property_sales_channels_pkey PRIMARY KEY (id),
  CONSTRAINT property_sales_channels_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT property_sales_channels_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id),
  CONSTRAINT property_sales_channels_sales_channel_id_fkey FOREIGN KEY (sales_channel_id) REFERENCES public.sales_channels(id),
  CONSTRAINT property_sales_channels_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.sales_channels (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  person_id uuid NOT NULL,
  logo_url text,
  sales_commission numeric NOT NULL DEFAULT 0.00 CHECK (sales_commission >= 0::numeric AND sales_commission <= 100::numeric),
  collection_commission numeric NOT NULL DEFAULT 0.00 CHECK (collection_commission >= 0::numeric AND collection_commission <= 100::numeric),
  applicable_taxes text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  apply_tax boolean NOT NULL DEFAULT false,
  tax_type_id uuid,
  is_own_channel boolean NOT NULL DEFAULT false,
  CONSTRAINT sales_channels_pkey PRIMARY KEY (id),
  CONSTRAINT sales_channels_tax_type_id_fkey FOREIGN KEY (tax_type_id) REFERENCES public.configuration_values(id),
  CONSTRAINT sales_channels_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT sales_channels_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.persons(id),
  CONSTRAINT sales_channels_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.service_provider_services (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  service_provider_id uuid NOT NULL,
  service_type_id uuid NOT NULL,
  price_type character varying NOT NULL DEFAULT 'fixed'::character varying CHECK (price_type::text = ANY (ARRAY['fixed'::character varying, 'percentage'::character varying]::text[])),
  price numeric NOT NULL CHECK (price >= 0::numeric),
  apply_tax boolean NOT NULL DEFAULT false,
  tax_type_id uuid,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT service_provider_services_pkey PRIMARY KEY (id),
  CONSTRAINT service_provider_services_service_provider_id_fkey FOREIGN KEY (service_provider_id) REFERENCES public.service_providers(id),
  CONSTRAINT service_provider_services_service_type_id_fkey FOREIGN KEY (service_type_id) REFERENCES public.configuration_values(id),
  CONSTRAINT service_provider_services_tax_type_id_fkey FOREIGN KEY (tax_type_id) REFERENCES public.configuration_values(id)
);
CREATE TABLE public.service_providers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  person_id uuid NOT NULL,
  logo_url text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT service_providers_pkey PRIMARY KEY (id),
  CONSTRAINT service_providers_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT service_providers_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.persons(id),
  CONSTRAINT service_providers_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.tenants (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  slug character varying NOT NULL UNIQUE,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT tenants_pkey PRIMARY KEY (id)
);
CREATE TABLE public.tips (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  guide_id uuid NOT NULL,
  tenant_id uuid NOT NULL,
  title character varying NOT NULL,
  description text,
  details text,
  icon character varying DEFAULT 'Lightbulb'::character varying,
  order_index integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT tips_pkey PRIMARY KEY (id),
  CONSTRAINT tips_guide_id_fkey FOREIGN KEY (guide_id) REFERENCES public.property_guides(id),
  CONSTRAINT tips_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.treasury_accounts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  name character varying NOT NULL CHECK (length(TRIM(BOTH FROM name)) > 0),
  account_number character varying,
  bank_name character varying,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT treasury_accounts_pkey PRIMARY KEY (id),
  CONSTRAINT treasury_accounts_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.user_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  setting_key character varying NOT NULL,
  setting_value text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_settings_pkey PRIMARY KEY (id),
  CONSTRAINT user_settings_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  email character varying NOT NULL UNIQUE,
  full_name character varying,
  avatar_url text,
  theme_color character varying DEFAULT 'blue'::character varying,
  language character varying DEFAULT 'es'::character varying,
  timezone character varying DEFAULT 'Europe/Madrid'::character varying,
  date_format character varying DEFAULT 'DD/MM/YYYY'::character varying,
  number_format character varying DEFAULT 'es-ES'::character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  is_admin boolean DEFAULT false,
  password_change_required boolean DEFAULT false,
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);